export function parseElement(e,t){let r=e.length,l=e[t],n=/[A-Z]/.test(l);if(t<r&&n){let n=l;if((t+=1)<r){let r=e[t];/[a-z]/.test(r)&&(n+=r,t+=1)}return[n,t]}throw new Error("Invalid element at position "+t)}export function parseNumber(e,t){let r=0,l=e.length;for(;t<l;){let l=e[t];if(!/[0-9]/.test(l))break;r=10*r+parseInt(l),t+=1}return[r>0?r:1,t]}export function calculateMolarMass(e,t){let r=[0],l=0,n=e.length;for(;l<n;){let n=e[l];if(/[A-Z]/.test(n)){let n=parseElement(e,l),o=n[0];l=n[1];let a=parseNumber(e,l),s=a[0];l=a[1];let f=null;for(let e=0;e<t.length;e++)if(t[e].symbol==o){f=t[e];break}if(null==f)throw new Error("Element not found: "+o);{let e=r.length-1;r[e]=r[e]+f.atomicMass*s}}else if("("==n)r.push(0),l+=1;else{if(")"!=n)throw new Error("Invalid character: "+n);{if(r.length<2)throw new Error('Unmatched ")"');let t=r.pop(),n=parseNumber(e,l+1);l=n[1];let o=r.length-1;r[o]=r[o]+t*n[0]}}}if(r.length>1)throw new Error('Unmatched "("');return r[0]}export function formatFormula(e){let t,r={},l=/([A-Z][a-z]*)(\d*)/g,n=0;for(;null!=(t=l.exec(e));){let o=t[1],a=t[2]?parseInt(t[2]):1;if(r[o])throw new Error("Oops, "+o+" shows up twice in "+e);r[o]=a,n=l.lastIndex}if(n!=e.length)throw new Error("Bad formula: "+e);return r}