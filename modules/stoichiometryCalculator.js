export function parseBalancedEquation(e){let t=e.replace(/\s+/g,"").split("->");if(2!=t.length)throw new Error('Invalid equation format: missing "->"');let l=t[0].split("+"),o=t[1].split("+"),r=[],a=[];for(let e=0;e<l.length;e++)r.push(parseTerm(l[e]));for(let e=0;e<o.length;e++)a.push(parseTerm(o[e]));return{reactants:r,products:a}}export function parseTerm(e){let t=e.match(/^(\d+)?(.+)$/);if(!t)throw new Error("Invalid term: "+e);let l=t[1]?parseInt(t[1]):1;return{formula:t[2],coefficient:l}}export function getCalculationType(e){let t=parseBalancedEquation(e),l=document.getElementById("stoich-inputs");l.innerHTML="";let o=document.getElementById("calculation-type").value;if("product-from-reactant"==o){let e="";for(let l=0;l<t.reactants.length;l++){let o=t.reactants[l];e=e+'<option value="'+o.formula+'">'+o.formula+"</option>"}let o='<select id="reactant-select">'+e+"</select>",r='<input type="number" id="reactant-moles" placeholder="Moles of reactant" min="0" step="any">',a="";for(let e=0;e<t.products.length;e++){let l=t.products[e];a=a+'<option value="'+l.formula+'">'+l.formula+"</option>"}l.innerHTML="<p>Select reactant: "+o+"</p><p>Enter moles: "+r+'</p><p>Select product: <select id="product-select">'+a+"</select></p>",l.classList.add("show")}else if("reactant-from-product"==o){let e="";for(let l=0;l<t.products.length;l++){let o=t.products[l];e=e+'<option value="'+o.formula+'">'+o.formula+"</option>"}let o='<select id="product-select">'+e+"</select>",r='<input type="number" id="product-moles" placeholder="Moles of product" min="0" step="any">',a="";for(let e=0;e<t.reactants.length;e++){let l=t.reactants[e];a=a+'<option value="'+l.formula+'">'+l.formula+"</option>"}l.innerHTML="<p>Select product: "+o+"</p><p>Enter moles: "+r+'</p><p>Select reactant: <select id="reactant-select">'+a+"</select></p>",l.classList.add("show")}else if("limiting-reactant"==o){let e="";for(let l=0;l<t.reactants.length;l++){let o=t.reactants[l];e=e+"<p>"+o.formula+': <input type="number" id="moles-'+o.formula+'" placeholder="Moles of '+o.formula+'" min="0" step="any"></p>'}let o="";for(let e=0;e<t.products.length;e++){let l=t.products[e];o=o+'<option value="'+l.formula+'">'+l.formula+"</option>"}l.innerHTML=e+'<p>Select product to calculate: <select id="product-select">'+o+"</select></p>",l.classList.add("show")}}export function calculateStoichiometry(e){let t=document.getElementById("calculation-type").value,l=document.getElementById("stoich-result"),o=parseBalancedEquation(e);if("product-from-reactant"==t){let e=document.getElementById("reactant-select").value,t=document.getElementById("reactant-moles"),r=parseFloat(t.value),a=document.getElementById("product-select").value;if(isNaN(r)||!(r>0))throw t.classList.add("error"),new Error("Invalid moles input");t.classList.remove("error");let n=null;for(let t=0;t<o.reactants.length;t++)if(o.reactants[t].formula==e){n=o.reactants[t];break}let c=null;for(let e=0;e<o.products.length;e++)if(o.products[e].formula==a){c=o.products[e];break}if(null==n||null==c)throw new Error("Selected compound not found");l.innerHTML="<p>Moles of "+a+": "+(r/n.coefficient*c.coefficient).toFixed(2)+"</p>",l.classList.add("show")}else if("reactant-from-product"==t){let e=document.getElementById("product-select").value,t=document.getElementById("product-moles"),r=parseFloat(t.value),a=document.getElementById("reactant-select").value;if(isNaN(r)||!(r>0))throw t.classList.add("error"),new Error("Invalid moles input");t.classList.remove("error");let n=null;for(let t=0;t<o.products.length;t++)if(o.products[t].formula==e){n=o.products[t];break}let c=null;for(let e=0;e<o.reactants.length;e++)if(o.reactants[e].formula==a){c=o.reactants[e];break}if(null==n||null==c)throw new Error("Selected compound not found");l.innerHTML="<p>Moles of "+a+": "+(r/n.coefficient*c.coefficient).toFixed(2)+"</p>",l.classList.add("show")}else if("limiting-reactant"==t){let e={};for(let t=0;t<o.reactants.length;t++){let l=o.reactants[t],r=document.getElementById("moles-"+l.formula),a=parseFloat(r.value);if(isNaN(a)||!(a>0))throw r.classList.add("error"),new Error("Invalid moles for "+l.formula);r.classList.remove("error"),e[l.formula]=a}let t=document.getElementById("product-select").value,r=null;for(let e=0;e<o.products.length;e++)if(o.products[e].formula==t){r=o.products[e];break}if(null==r)throw new Error("Selected product not found");let a=1/0,n=null;for(let t=0;t<o.reactants.length;t++){let l=o.reactants[t],r=e[l.formula]/l.coefficient;r<a&&(a=r,n=l.formula)}l.innerHTML="<p>Limiting reactant: "+n+"</p><p>Moles of "+t+": "+(a*r.coefficient).toFixed(2)+"</p>",l.classList.add("show")}}